language: node_js
node_js:
  - 10
before_install:
  - stty cols 80
dist: trusty
sudo: required
addons:
  firefox: latest
  apt:
    sources:
     - google-chrome
    packages:
     - google-chrome-stable fluxbox
before_script:
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
  - sleep 3
  - fluxbox >/dev/null 2>&1 &
install: 
  - npm install
jobs:
  include:
    - stage: test
      name: "Unit Testing"
      script: jest ./test/unit.test.js
    - script: jest ./test/integration.test.js
      name: "Integration Testing"
    - stage: deploy
      name: "Deploy to Heroku"
      if: branch = master
      deploy:
        skip_cleanup: true
        provider: heroku
        api_key:
          secure: 99e971fd-ded9-4202-a90a-74217c1b5dbb
        app: ewutest
        on:
          repo: ewujs/ci-test
          branch: master
      after_deploy:
        - testcafe chrome index-test.js